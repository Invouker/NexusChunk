name: Java CI s Gradle

# Workflow sa spustí pri:
# 1. Pri každom pushi na vetvu 'main'
# 2. Pri každom Pull Requeste smerujúcom do vetvy 'main'
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    # Build sa spustí na najnovšom Ubuntu Runneri
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
    # 1. Stiahnutie kódu z repozitára
    - name: Checkout kód
      uses: actions/checkout@v4

    # 2. Nastavenie Java verzie 25 (OpenJDK 25.0.1 alebo novšia)
    - name: Nastavenie JDK 25 (s cachovaním Gradle dependencies)
      uses: actions/setup-java@v4
      with:
        java-version: '25' # <--- ZMENENÉ NA VERZIU 25
        distribution: 'temurin' 
        cache: 'gradle' 

    # 3. Nastavenie Gradle (táto akcia tiež optimalizuje cachovanie)
    - name: Nastavenie Gradle
      uses: gradle/actions/setup-gradle@v4

    # 4. Spustenie celého buildu, ktorý zahŕňa kompiláciu a spustenie testov
    - name: Build a Testy s Gradle Wrapper
      run: ./gradlew build

    # 5. Uloženie finálneho .jar súboru ako artefaktu
    - name: Upload Build Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: nexus-chunk-jar
        path: build/libs/*.jar

  dependency-submission:
    # Tento job závisí od úspešného vykonania jobu 'build'
    needs: build
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
    - uses: actions/checkout@v4
    
    # Nastavenie Java verzie 25
    - name: Nastavenie JDK 25
      uses: actions/setup-java@v4
      with:
        java-version: '25' # <--- ZMENENÉ NA VERZIU 25
        distribution: 'temurin'

    # Generuje a odosiela graf závislostí pre Dependabot a bezpečnostné skenovanie
    - name: Generovanie a odoslanie grafu závislostí
      uses: gradle/actions/dependency-submission@v4

